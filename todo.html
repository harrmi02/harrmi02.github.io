<html>
<head>
    <title>To Do List</title>
	<link rel="stylesheet" href="ToDo.css" type="text/css"/>
	<script type = "text/javascript">

        Task = function(){
        	this.name;
        	this.priority;
        	this.dueDate;
        	this.project;
        	this.done;
        	this.spot = 0;
        	
        }


        TaskList = function () {
            var tasks = [];

            this.getTasks = function () {
                return tasks;
            }

            this.addTask = function (newTask) {
                tasks.push(newTask);
                newTask.spot = tasks.length - 1;
            }

            this.removeTask = function (task) {
                tasks.splice(task.spot, 1);
                for (var i = 0; i < tasks.length; i++) {
                    tasks[i].spot = i;
                }
            }

            this.saveAll = function () {
                res = [];
                var i;

                for (i = 0; i < tasks.length; i++) {
                    if (!tasks[i].done) {
                        res.push(tasks[i]);
                    }
                }
                localStorage.setItem("todoDatabase", JSON.stringify(res));
            }

            this.display = function () {

                for (i = 0; i < taskList.getTasks().length; i++) {
                    table = document.querySelector('#list');
                    row = document.createElement('tr');
                    taskPlace = document.createElement('td');
                    date = document.createElement('td');
                    

                    task = tasks[i];
                    checkBox = document.createElement('input');
                    checkBox.type = 'checkbox';
                    checkBox.id = task.spot.toString();
                    checkBox.onclick = taskDone;
                    taskPlace.innerHTML = task.name;
                    taskPlace.className = task.priority;
                    date.innerHTML = task.dueDate;                    

                    table.appendChild(row);
                    row.appendChild(checkBox);
                    row.appendChild(taskPlace);
                    row.appendChild(date);
                }

            }


            this.restoreAll = function () {
                oldList = JSON.parse(localStorage.getItem("todoDatabase"));
                for (i = 0; i < oldList.length; i++) {
                    this.addTask(oldList[i]);
                }

                this.display();
            }


        }

        taskList = new TaskList();

        taskDone = function () {
            var place = parseInt(this.id);
            var task = taskList.getTasks()[place];
            var name = this.nextSibling;
            if (!task.done) {
                name.style.textDecoration = 'line-through';
                task.done = true;
            
            } else {
                name.style.textDecoration = 'none';
                task.done = false;
            }
            taskList.saveAll();
        }
        

        addTask = function () {

            newTask = new Task();

            newTask.name = document.querySelector('#newTask').value;

            newTask.priority = document.querySelector('#priority').value;

            newTask.dueDate = document.querySelector('#date').value;

            newTask.done = false;

            table = document.querySelector('#list');

            for (i = 0; i < taskList.getTasks().length; i++) {
                table.deleteRow();
            }

            taskList.addTask(newTask);

            taskList.display();

            document.querySelector('#newTask').value = "";
            taskList.saveAll();
        }

	</script>
</head>
<body onload="taskList.restoreAll()">
    
	<div>
        <p>To Do List</p>
        <div id="addTask">
            <section>
                <label for='newTask'>Task Name:</label>
                <input id="newTask" type="text"/>
                <select id="priority">
                    <option value="low">Low Priority</option>
                    <option value="med">Medium Proirity</option>
                    <option value="high">High Priority</option>
                </select>
                <label for="date">Due On:</label>
                <input id="date" type="date" />
                
            </section>
            <button id="add" onclick="addTask()">Add</button>
        </div>  
        <article>
            <table id="list"></table>
        </article>

	</div>
</body>
</html>