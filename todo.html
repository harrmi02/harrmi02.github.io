<html>
<head>
    <title>To Do List</title>
	<link rel="stylesheet" href="ToDo.css" type="text/css"/>
	<script type = "text/javascript">
        
        //taskCount = 0;     
        
        taskDone = function(){
        	//box = document.getElementById(id);
            task = this.nextSibling;
            if (this.checked) {
                task.style.textDecoration = 'line-through';
                task.className = "done";
            } else {
                task.style.textDecoration = 'none';
                task.className = "pending";
                    }
        }   
        
        localSave = function(){
        	res = [];
        	var i;
        	allEntries = document.querySelectorAll('td');
        	for(i=0; i< allEntries.length; i++){
        		if(allEntries[i].className != "done"){
        			res.push(allEntries[i].innerText);
        			}
        		}
        		console.log(res)
        		//store the array in localStoreage
        		//alert(JSON.stringify(res));
        		localStorage.setItem("todoDatabase", JSON.stringify(res));
        }
        
        restoreList = function(){
        	taskCount = 0;
        	oldList = JSON.parse(localStorage.getItem("todoDatabase"));
        	for(i = 0; i < oldList.length; i++){
        		taskCount++;
        		table = document.querySelector('#list');
                row = document.createElement('tr');
                task = document.createElement('td');
                
                task.innerHTML = oldList[i];
                
                checkBox = document.createElement('input');
                checkBox.type = 'checkbox';
                var id = taskCount.toString();
                checkBox.id = id;

                table.appendChild(row);
                row.appendChild(checkBox);
                row.appendChild(task);

                checkBox.onclick = taskDone;
        	}
        }

        addTask = function () {
            if (document.querySelector('#newTask').value != "") {
                var newTask;
                taskCount++;
                
                table = document.querySelector('#list');
                row = document.createElement('tr');
                task = document.createElement('td');

                newTask = document.querySelector('#newTask').value;
                task.innerHTML = newTask;

                checkBox = document.createElement('input');
                checkBox.type = 'checkbox';
                var id = taskCount.toString();
                checkBox.id = id;

                table.appendChild(row);
                row.appendChild(checkBox);
                row.appendChild(task);

                checkBox.onclick = taskDone;

                document.querySelector('#newTask').value = "";
                localSave();
            }
            }
	</script>
</head>
<body onload = "restoreList()">
    
	<div>
        <p>To Do List</p>
        <div id="addTask">
            <section>
                <label for='newTask'>New Task:</label>
                <input id="newTask" type="text" onchange="addTask()" />
                <button id="add" onclick="addTask()">Add</button>
            </section>
        </div>  
        <article>
            <table id="list"></table>
        </article>

	</div>
</body>
</html>